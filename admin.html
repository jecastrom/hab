<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin – Neues Objekt hinzufügen</title>

  
  <style>
      :root {
    --bg: #ffffff;
    --text: #000000;
    --card-bg: #f9f9f9;
    --border: #ccc;
    --header-bg: #f0f0f0;
    --button-bg: #007bff;
    --button-hover: #0056b3;
    --clear-bg: #6c757d;
    --clear-hover: #545b62;
    --th-bg: #f0f0f0;
  }

  body.dark-mode {
    --bg: #121212;
    --text: #e0e0e0;
    --card-bg: #1e1e1e;
    --border: #444;
    --header-bg: #1f1f1f;
    --button-bg: #0d6efd;
    --button-hover: #0b5ed7;
    --clear-bg: #495057;
    --clear-hover: #343a40;
    --th-bg: #2c2c2c;
  }

  body {
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s, color 0.3s;
  }

  .container {
    background: var(--card-bg);
    border: 1px solid var(--border);
  }

  button {
    background: var(--button-bg);
  }
  button:hover {
    background: var(--button-hover);
  }
  /* Add more elements if needed, e.g. inputs, labels */
  input, select {
    background: var(--bg);
    color: var(--text);
    border: 1px solid var(--border);
  }
    body { font-family: Arial, sans-serif; margin: 40px; background: #f4f4f4; color: #333; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #007bff; }
    label { display: block; margin: 15px 0 5px; font-weight: bold; }
    input, button { width: 100%; padding: 10px; font-size: 1em; box-sizing: border-box; margin-bottom: 10px; }
    button { background: #28a745; color: white; border: none; cursor: pointer; font-size: 1.1em; border-radius: 5px; }
    button:hover { background: #218838; }
    #message { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .help { font-size: 0.9em; color: #666; margin-top: 5px; }
    a.back { display: block; text-align: center; margin-top: 30px; color: #007bff; text-decoration: none; }
    a.back:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin: Neues Objekt hinzufügen</h1>
    <p>Fülle die Felder aus und lade (falls vorhanden) die JSON-Datei hoch. Das System aktualisiert automatisch die Webseite.</p>

    <label for="code">Interner Code (klein, z. B. "mno"):</label>
    <input type="text" id="code" placeholder="mno">

    <label for="name">Anzeigename (z. B. "MNO"):</label>
    <input type="text" id="name" placeholder="MNO">

    <label for="jsonFile">JSON-Datei mit den Objektdaten (optional, falls noch nicht vorhanden):</label>
    <input type="file" id="jsonFile" accept=".json">
    <div class="help">Bitte lade hier die JSON-Datei hoch, die die Daten für dieses Objekt enthält (gleiche Struktur wie hab.json). 
    Wenn die Datei noch nicht existiert, kannst du dieses Feld leer lassen – sie wird später hinzugefügt.</div>

    <button onclick="addObject()">Objekt hinzufügen</button>

    <div id="message"></div>

    <a class="back" href="index.html">← Zurück zur Suchseite</a>
  </div>

  <script>
    async function addObject() {
      const code = document.getElementById('code').value.trim().toLowerCase();
      const name = document.getElementById('name').value.trim();
      const fileInput = document.getElementById('jsonFile');
      const messageDiv = document.getElementById('message');

      messageDiv.style.display = 'none';

      if (!code || !name) {
        messageDiv.textContent = 'Bitte Code und Anzeigename ausfüllen!';
        messageDiv.className = 'error';
        messageDiv.style.display = 'block';
        return;
      }

      let jsonBase64 = null;
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        if (!file.name.endsWith('.json')) {
          messageDiv.textContent = 'Bitte nur .json-Dateien hochladen!';
          messageDiv.className = 'error';
          messageDiv.style.display = 'block';
          return;
        }
        const reader = new FileReader();
        await new Promise((resolve) => {
          reader.onload = () => {
            jsonBase64 = reader.result.split(',')[1]; // base64 part
            resolve();
          };
          reader.readAsDataURL(file);
        });
      }

      try {
        const res = await fetch('/api/add-object', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, name, jsonContent: jsonBase64 })
        });
        const text = await res.text();
        messageDiv.textContent = res.ok ? text : 'Fehler: ' + text;
        messageDiv.className = res.ok ? 'success' : 'error';
        messageDiv.style.display = 'block';
      } catch (e) {
        messageDiv.textContent = 'Verbindungsfehler: ' + e.message;
        messageDiv.className = 'error';
        messageDiv.style.display = 'block';
      }
    }
  </script>
  <script>
  // Apply saved dark mode preference on page load
  if (localStorage.getItem('darkMode') === 'enabled') {
    document.body.classList.add('dark-mode');
  }
</script>
</body>
</html>
